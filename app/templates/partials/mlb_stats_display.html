<div class="mt-2 text-sm text-slate-600 dark:text-slate-300">
    {% if item.player %}
        {# Logic for a tracked player: Show only their stats #}
        {% set player_id_to_find = item.player.external_id %}
        {% set p_stat = none %}
        {# Safely access nested dictionaries #}
        {% if match_data %}
            {% set home_players = match_data.get('home_team', {}).get('players', {}) %}
            {% set away_players = match_data.get('away_team', {}).get('players', {}) %}
            {% set p_stat = home_players.get(player_id_to_find) or away_players.get(player_id_to_find) %}
        {% endif %}

        <div class="font-mono text-xs p-2 bg-slate-900/50 rounded">
            <span id="item-{{ item.id }}-summary" class="font-semibold">{{ p_stat.summary if p_stat else 'Loading...' }}</span>
        </div>

    {% elif item.team %}
        {# Logic for a tracked team: Show the full box score #}
        {% set away_team = match_data.get('away_team', {}) if match_data else {} %}
        {% set home_team = match_data.get('home_team', {}) if match_data else {} %}
        <div class="mt-4 space-y-4">
            <div class="border-t border-slate-300 dark:border-slate-600 pt-2">
                <h4 class="text-sm font-bold text-slate-600 dark:text-slate-400 mb-2">Box Score</h4>
                <div class="grid grid-cols-2 gap-x-4">
                    <!-- Away Team -->
                    <div id="item-{{item.id}}-mlb-match-{{match_data.get('id', 'loading')}}-team-{{away_team.get('id')}}-box" class="p-2 {% if away_team.get('id') == item.team.id %}bg-blue-900/60 rounded-md{% endif %}">
                        <h5 class="text-xs font-semibold text-center mb-1 {% if away_team.get('id') == item.team.id %}text-white{% endif %}">{{ away_team.get('name', 'Away Team') }}</h5>
                        <table class="w-full text-xs text-center"><tbody>
                            {% for player_id, player_stats in away_team.get('players', {}).items() %}
                            <tr class="border-b border-transparent">
                                <td class="text-left py-1 px-2">{{ player_stats.get('name', 'Player') }}</td>
                                <td id="item-{{item.id}}-mlb-match-{{match_data.get('id', 'loading')}}-player-{{player_id}}-summary" class="text-right py-1 px-2">{{ player_stats.get('summary', '--') }}</td>
                            </tr>
                            {% endfor %}
                        </tbody></table>
                    </div>
                    <!-- Home Team -->
                    <div id="item-{{item.id}}-mlb-match-{{match_data.get('id', 'loading')}}-team-{{home_team.get('id')}}-box" class="p-2 {% if home_team.get('id') == item.team.id %}bg-blue-900/60 rounded-md{% else %}border-l border-slate-300 dark:border-slate-600 pl-4{% endif %}">
                        <h5 class="text-xs font-semibold text-center mb-1 {% if home_team.get('id') == item.team.id %}text-white{% endif %}">{{ home_team.get('name', 'Home Team') }}</h5>
                        <table class="w-full text-xs text-center"><tbody>
                            {% for player_id, player_stats in home_team.get('players', {}).items() %}
                            <tr class="border-b border-transparent">
                                <td class="text-left py-1 px-2">{{ player_stats.get('name', 'Player') }}</td>
                                <td id="item-{{item.id}}-mlb-match-{{match_data.get('id', 'loading')}}-player-{{player_id}}-summary" class="text-right py-1 px-2">{{ player_stats.get('summary', '--') }}</td>
                            </tr>
                            {% endfor %}
                        </tbody></table>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>